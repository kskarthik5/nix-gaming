From 5e2c10f620f9e9b92c924e706f4d6c1b5132277e Mon Sep 17 00:00:00 2001
From: Alexandros Frantzis <alexandros.frantzis@collabora.com>
Date: Thu, 30 Sep 2021 11:24:36 +0300
Subject: [PATCH 111/170] winewayland.drv: Destroy GL drawable on window
 destruction.

Signed-off-by: Alexandros Frantzis <alexandros.frantzis@collabora.com>
---
 dlls/winewayland.drv/opengl.c     | 6 +++++-
 dlls/winewayland.drv/waylanddrv.h | 1 +
 dlls/winewayland.drv/window.c     | 1 +
 3 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/dlls/winewayland.drv/opengl.c b/dlls/winewayland.drv/opengl.c
index 63c6146d1dd..2bcc4e95c9b 100644
--- a/dlls/winewayland.drv/opengl.c
+++ b/dlls/winewayland.drv/opengl.c
@@ -202,7 +202,7 @@ static void wayland_gl_drawable_clear_buffers(struct wayland_gl_drawable *gl)
         wayland_gl_buffer_destroy(gl_buffer);
 }
 
-static void wayland_destroy_gl_drawable(HWND hwnd)
+void wayland_destroy_gl_drawable(HWND hwnd)
 {
     struct wayland_gl_drawable *gl;
 
@@ -1641,4 +1641,8 @@ void wayland_update_gl_drawable_surface(HWND hwnd, struct wayland_surface *wayla
 {
 }
 
+void wayland_destroy_gl_drawable(HWND hwnd)
+{
+}
+
 #endif
diff --git a/dlls/winewayland.drv/waylanddrv.h b/dlls/winewayland.drv/waylanddrv.h
index e578e085b8e..1d7f63c5f05 100644
--- a/dlls/winewayland.drv/waylanddrv.h
+++ b/dlls/winewayland.drv/waylanddrv.h
@@ -536,6 +536,7 @@ BOOL wayland_gbm_init(void) DECLSPEC_HIDDEN;
  */
 
 void wayland_update_gl_drawable_surface(HWND hwnd, struct wayland_surface *wayland_surface) DECLSPEC_HIDDEN;
+void wayland_destroy_gl_drawable(HWND hwnd) DECLSPEC_HIDDEN;
 
 /**********************************************************************
  *          Registry helpers
diff --git a/dlls/winewayland.drv/window.c b/dlls/winewayland.drv/window.c
index 484079b6437..bcb7a0dfb56 100644
--- a/dlls/winewayland.drv/window.c
+++ b/dlls/winewayland.drv/window.c
@@ -930,6 +930,7 @@ void WAYLAND_DestroyWindow(HWND hwnd)
     TRACE("%p\n", hwnd);
 
     if (!(data = wayland_win_data_get(hwnd))) return;
+    wayland_destroy_gl_drawable(hwnd);
     wayland_win_data_destroy(data);
 }
 
-- 
2.36.1

